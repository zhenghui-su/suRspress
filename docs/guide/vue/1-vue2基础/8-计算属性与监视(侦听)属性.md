## è®¡ç®—å±æ€§ä¸ç›‘è§†(ä¾¦å¬)å±æ€§

### å§“åæ¡ˆä¾‹-å¼•å‡ºè®¡ç®—å±æ€§-computed

æ•ˆæœï¼šä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œä¸€ä¸ªè¾“å…¥å§“ï¼Œä¸€ä¸ªè¾“å…¥åï¼Œæœ€åä¸€ä¸ª span æ˜¾ç¤ºå…¨åï¼Œéœ€è¦å®æ—¶æ›´æ”¹

- ä½¿ç”¨æ’å€¼è¯­æ³•å®ç°

```html
<div id="root">
  å§“ï¼š<input type="text" v-model="firstName" /> <br /><br />
  åï¼š<input type="text" v-model="lastName" /> <br /><br />
  å…¨åï¼š<span>{{firstName}}-{{lastName}}</span>
</div>
<script type="text/javascript">
  Vue.config.productionTip = false; //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

  new Vue({
    el: '#root',
    data: {
      firstName: 'å¼ ',
      lastName: 'ä¸‰',
    },
  });
</script>
```

- ä½¿ç”¨ methods å®ç°

```html
<div id="root">
  å§“ï¼š<input type="text" v-model="firstName" /> <br /><br />
  åï¼š<input type="text" v-model="lastName" /> <br /><br />
  å…¨åï¼š<span>{{fullName()}</span>
</div>
<script type="text/javascript">
  Vue.config.productionTip = false; //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

  new Vue({
    el: '#root',
    data: {
      firstName: 'å¼ ',
      lastName: 'ä¸‰',
    },
    methods: {
      fullName() {
        return this.firstName + '-' + this.lastName;
      },
    },
  });
</script>
```

- **è®¡ç®—å±æ€§ computed**âœ”
  - å®šä¹‰ï¼šè¦ç”¨çš„å±æ€§ä¸å­˜åœ¨ï¼Œéœ€è¦é€šè¿‡å·²æœ‰å±æ€§è®¡ç®—å¾—æ¥
  - åŸç†ï¼šåº•å±‚å€ŸåŠ©`Object.defineproperty`æ–¹æ³•æä¾›çš„ getter å’Œ setter
  - get å‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ
    - åˆæ¬¡è¯»å–æ—¶ä¼šæ‰§è¡Œä¸€æ¬¡
    - å½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ä¼šå†æ¬¡æ‰§è¡Œ
  - ä¼˜åŠ¿ï¼šä¸ methods ç›¸æ¯”ï¼Œå†…éƒ¨æœ‰ç¼“å­˜æœºåˆ¶ï¼ˆå¤ç”¨ï¼‰ï¼Œæ•ˆç‡é«˜ä¸”è°ƒè¯•æ–¹ä¾¿
  - å¤‡æ³¨ï¼š
    - è®¡ç®—å±æ€§æœ€ç»ˆä¼šå‡ºç°åœ¨ç»‘å®šçš„ Vue å®ä¾‹ vm ä¸Šï¼Œç›´æ¥è¯»å–ä½¿ç”¨å³å¯
    - å¦‚æœè®¡ç®—å±æ€§è¦è¢«ä¿®æ”¹ï¼Œå¿…é¡»å†™ set å‡½æ•°å»å“åº”ä¿®æ”¹ï¼Œä¸” set ä¸­è¦å¼•èµ·ä¾èµ–æ•°æ®å‘ç”Ÿå˜åŒ–

```html
<div id="root">
  å§“ï¼š<input type="text" v-model="firstName" /> <br /><br />
  åï¼š<input type="text" v-model="lastName" /> <br /><br />
  å…¨åï¼š<span>{{fullName}}</span> å…¨åï¼š<span>{{fullName}}</span>
</div>
<script type="text/javascript">
  Vue.config.productionTip = false; //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

  const vm = new Vue({
    el: '#root',
    data: {
      firstName: 'å¼ ',
      lastName: 'ä¸‰',
    },
    computed: {
      fullName: {
        // å½“è¯»å–fullNameæ—¶ï¼Œgetå°±ä¼šè¢«è°ƒç”¨ï¼Œè¿”å›å€¼å°±ä¸ºfullNameçš„å€¼
        // getåœ¨åˆæ¬¡è¯»å–fullNameæ—¶ï¼Œå’Œæ‰€ä¾èµ–çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œgetä¼šè°ƒç”¨
        get() {
          console.log('getè¢«è°ƒç”¨äº†'); // getä¼šæœ‰ç¼“å­˜
          // æ­¤å¤„thisæ˜¯vm
          return this.firstName + '-' + this.lastName;
        },
        // å½“fullNameè¢«ä¿®æ”¹æ—¶setè°ƒç”¨
        set(value) {
          console.log('set', value);
          // æ§åˆ¶æ”¹å˜fullName vm.fullName="æ-å››"
          const arr = value.split('-');
          this.firstName = arr[0];
          this.lastName = arr[0];
        },
      },
    },
  });
</script>
```

ğŸ’¬ å¦‚æœåªéœ€è¯»å–ä¸ä¿®æ”¹ï¼Œå¯ä»¥ç®€å†™ä¸ºä¸‹é¢å½¢å¼(å³ç›´æ¥ä¸€ä¸ªå‡½æ•°)

```js
const vm = new Vue({
  el: '#root',
  data: {
    firstName: 'å¼ ',
    lastName: 'ä¸‰',
  },
  computed: {
    fullName() {
      console.log('getè¢«è°ƒç”¨äº†');
      return this.firstName + '-' + this.lastName;
    },
  },
});
```

### å¤©æ°”æ¡ˆä¾‹-å¼•å‡ºç›‘è§†å±æ€§-watch

æ•ˆæœï¼šé¡µé¢ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åˆ‡æ¢é¡µé¢ä¸­çš„å¤©æ°”(æ–‡å­—)ï¼Œä»Šå¤©å¤©æ°”å¾ˆå‡‰çˆ½(ç‚çƒ­)

- ä»¥ä¹‹å‰çš„å­¦çš„çŸ¥è¯†çš„å†™æ³•

```html
<div id="root">
  <h2>ä»Šå¤©å¤©æ°”å¾ˆ{{ info }}</h2>
  <!--<button @click="isHot = !isHot">åˆ‡æ¢å¤©æ°”</button>å¯ä»¥è¿™æ ·å†™ä½†ä¸æ¨è-->
  <button @click="changeWeather">åˆ‡æ¢å¤©æ°”</button>
</div>
<script type="text/javascript">
  Vue.config.productionTip = false; //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

  const vm = new Vue({
    el: '#root',
    data: {
      isHot: true,
    },
    methods: {
      changeWeather() {
        this.isHot = !this.isHot;
      },
    },
    computed: {
      info() {
        return this.isHot ? 'ç‚çƒ­' : 'å‡‰çˆ½';
      },
    },
  });
</script>
```

- **ç›‘è§†å±æ€§ watch**âœ”(**ä¾¦å¬å±æ€§**)
  - å½“ç›‘è§†å±æ€§å˜åŒ–æ—¶ï¼Œå›è°ƒå‡½æ•°è‡ªåŠ¨è°ƒç”¨ï¼Œè¿›è¡Œç›¸å…³æ“ä½œ
  - ç›‘è§†çš„å±æ€§å¿…é¡»å­˜åœ¨æ‰èƒ½è¿›è¡Œç›‘è§†
  - ç›‘è§†çš„ä¸¤ç§å†™æ³•
    - `new  Vue`æ—¶ä¼ å…¥ watch é…ç½®
    - é€šè¿‡`vm.$watch`ç›‘è§†
  - æ·±åº¦ç›‘è§†-deep
    - Vue ä¸­çš„ watch é»˜è®¤ä¸ç›‘æµ‹å¯¹è±¡å†…éƒ¨å€¼çš„æ”¹å˜(ä¸€å±‚)
    - é…ç½®`deep:true`å¯ä»¥ç›‘æµ‹å¯¹è±¡å†…éƒ¨å€¼æ”¹å˜(å¤šå±‚)
    - å¤‡æ³¨ï¼š
      - Vue è‡ªèº«å¯ä»¥ç›‘æµ‹å¯¹è±¡å†…éƒ¨å€¼çš„æ”¹å˜ï¼Œä½† Vue æä¾›çš„ watch é»˜è®¤ä¸å¯ä»¥
      - ä½¿ç”¨ watch æ—¶æ ¹æ®æ•°æ®çš„å…·ä½“ç»“æ„ï¼Œå†³å®šæ˜¯å¦é‡‡ç”¨æ·±åº¦ç›‘è§†

```html
<div id="root">
	<h2>ä»Šå¤©å¤©æ°”å¾ˆ{{ info }}</h2>
    <button @click="changeWeather">åˆ‡æ¢å¤©æ°”</button> <br/>
    <h3>açš„å€¼æ˜¯{{numbers.a}}</h2>
    <button @click="numbers.a++">açš„å€¼+1</button>
    <h3>bçš„å€¼æ˜¯{{numbers.b}}</h2>
    <button @click="numbers.b++">bçš„å€¼+1</button>
</div>
<script type="text/javascript">
	Vue.config.productionTip = false //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

	const vm = new Vue({
		el:'#root',
		data:{
			isHot:true,
            numbers:{
                a:1,
                b:1
            }
		},
        methods: {
            changeWeather(){
                this.isHot = !this.isHot;
            }
        },
		computed:{
            info(){
                return this.isHot ? 'ç‚çƒ­' : 'å‡‰çˆ½';
            }
        },
        watch:{
            isHot:{
                immediate: true, // åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€ä¸‹handler
                // é…ç½®å€¼ï¼ˆisHotï¼‰æ”¹å˜æ—¶è°ƒç”¨
                handler(newValue,oldValue){
                    console.log('è°ƒç”¨äº†',newValue,oldValue);
                }
            },
            // ç›‘è§†å¤šçº§ç»“æ„ä¸­æŸä¸ªå±æ€§çš„å˜åŒ–
            /*'numbers.a':{
                handler(){
                    console.log('aè¢«æ”¹å˜äº†');
                }
            }*/
            // ç›‘è§†å¤šçº§ç»“æ„ä¸­æ‰€æœ‰å±æ€§çš„å˜åŒ–
            // åªç›‘è§†numbersæ•´ä½“ä¸ç›‘è§†é‡Œé¢çš„aå’Œbçš„å€¼
            // é™¤éaå’Œbè¢«æ”¹ å¦‚ numbers={a:66,b:88}
            numbers:{
                deep:true, // å¦‚æœå¼€å¯æ·±åº¦ç›‘è§†åˆ™aå’Œbçš„å€¼æ”¹å˜ä¹Ÿä¼šè°ƒç”¨handler
                handler(){
                    console.log('numbersæ”¹å˜äº†')
                }
            }
        }
	})
    /* ä¹Ÿå¯ä»¥ç”¨vmæ¥ç›‘è§†
    vm.$watch('isHot',{
        immediate: true,
        handler(newValue,oldValue){
            console.log('è°ƒç”¨äº†',newValue,oldValue);
        }
    })*/
</script>
```

ğŸ’¬ å¦‚æœæ— éœ€`immediate:true`å’Œ`deep:true`å°±å¯ä»¥ç®€å†™ä¸ºå¦‚ä¸‹

```js
watch:{
    isHot(newValue,oldValue){
        console.log('isHotä¿®æ”¹äº†')
    }
}
// å¦ä¸€ç§
vm.$watch('isHot',funciton(newValue,oldValue){
    console.log('isHotä¿®æ”¹äº†')
})
```

### computed å’Œ watch çš„åŒºåˆ«

- computed èƒ½å®Œæˆçš„åŠŸèƒ½ï¼Œwatch éƒ½å¯ä»¥å®Œæˆ
- watch èƒ½å®Œæˆçš„åŠŸèƒ½ï¼Œcomputed å´ä¸ä¸€å®šèƒ½ï¼Œå¦‚ watch å¯ä»¥åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥çš„æ“ä½œæ—¶
- å°åŸåˆ™
  - æ‰€æœ‰è¢« Vue ç®¡ç†çš„å‡½æ•°ï¼Œå†™æˆæ™®é€šå‡½æ•°ï¼Œè¿™æ · this æŒ‡å‘ä¸º Vue ç»„ä»¶å®ä¾‹å¯¹è±¡
  - æ‰€æœ‰ä¸è¢« Vue ç®¡ç†çš„å‡½æ•°ï¼Œå¦‚å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ï¼ŒAjax çš„å›è°ƒå‡½æ•°ç­‰ï¼Œå†™æˆç®­å¤´å‡½æ•°ï¼Œè¿™æ · this æŒ‡å‘ä¸ä¼šè¢«å¹²æ‰°ï¼Œæœ€ç»ˆæŒ‡å‘ä¸º Vue ç»„ä»¶å®ä¾‹å¯¹è±¡
